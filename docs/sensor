# Halo 3C - Sensorer och Händelser

## Översikt

Halo 3C har **43 dokumenterade sensorer** och **26 händelsetyper**. Denna dokumentation beskriver alla sensorer, deras värden och hur händelser fungerar.

---

## Innehållsförteckning

1. [Miljösensorer](#miljösensorer)
2. [Luftkvalitetssensorer](#luftkvalitetssensorer)
3. [Ljudsensorer](#ljudsensorer)
4. [Rörelsesensorer](#rörelsesensorer)
5. [Hälsoindex](#hälsoindex)
6. [Händelsetyper](#händelsetyper)
7. [Händelsekonfiguration](#händelsekonfiguration)

---

## Miljösensorer

### Temperatur

**Sensorvägar:**
- `htsensor/ctemp` - Temperatur (°C)
- `htsensor/ftemp` - Temperatur (°F)

**Typ:** HT4 (Temperature/Humidity Sensor)

**Format:**
```json
{
  "TC": 28.78,  // Temperatur Celsius
  "TF": 83.8,   // Temperatur Fahrenheit
  "RH": 27.99   // Relativ luftfuktighet
}
```

**Användning:**
- Miljöövervakning
- HVAC-integration
- Komfortövervakning

### Luftfuktighet

**Sensorväg:** `htsensor/humidity`

**Enhet:** % (Relativ luftfuktighet)

**Typ:** HT4 (Temperature/Humidity Sensor)

**Användning:**
- Miljöövervakning
- HVAC-integration
- Komfortövervakning

### Lufttryck

**Sensorvägar:**
- `htsensor/press` - Lufttryck (inHg)
- `htsensor/millibar` - Lufttryck (hPa)

**Typ:** BR2 (Barometer)

**Användning:**
- Väderövervakning
- Höjdmätning

### Ljusnivå

**Sensorväg:** `luxsensor/aluxfilt`

**Enhet:** Lux

**Typ:** LUX (Light Sensor)

**Användning:**
- Belysningsövervakning
- Energioptimering
- Komfortövervakning

---

## Luftkvalitetssensorer

### Air Quality Index (AQI)

**Sensorväg:** `AQI/value`

**Enhet:** Index (0-500)

**Typ:** NC2 (AQI Board)

**Kategorier:**
- 0-50: Bra
- 51-100: Måttlig
- 101-150: Ohälsosamt för känsliga
- 151-200: Ohälsosamt
- 201-300: Mycket ohälsosamt
- 301-500: Farligt

**Sub-endpoints:**
- `/api/config/gstate/AQI/pm2p5` - PM2.5 AQI-data
- `/api/config/gstate/AQI/pm10` - PM10 AQI-data
- `/api/config/gstate/AQI/co` - CO AQI-data
- `/api/config/gstate/AQI/no2` - NO2 AQI-data

### CO2 (Koldioxid)

**Sensorvägar:**
- `co2sensor/co2` - CO2 kalibrerat (ppm)
- `co2sensor/co2o` - CO2 ekvivalent (ppm)

**Enhet:** ppm (parts per million)

**Typ:** CO2 Sensor

**Format:**
```json
{
  "co2": 558,      // CO₂-värde (ppm)
  "co2f": 563.13,  // Filtrerat CO₂-värde
  "tvoc": 81,      // TVOC-värde (ppb)
  "tvocf": 82.81   // Filtrerat TVOC-värde
}
```

**Användning:**
- Ventilationsövervakning
- IAQ (Indoor Air Quality)
- CO₂-nivåer för komfort (rekommenderat: <1000 ppm)

### TVOC (Total Volatile Organic Compounds)

**Sensorväg:** `co2sensor/tvoc`

**Enhet:** ppb (parts per billion)

**Typ:** CO2 Sensor

**Användning:**
- Luftkvalitetsövervakning
- Hälsövervakning
- Källidentifiering

### Partiklar

**Sensorvägar:**
- `pmsensor/raw/0` - PM1 partiklar (µg/m³)
- `pmsensor/raw/1` - PM2.5 partiklar (µg/m³)
- `pmsensor/raw/2` - PM10 partiklar (µg/m³)
- `pmsensor/AQIPM10` - PM10 AQI
- `pmsensor/AQIPM25` - PM2.5 AQI

**Enhet:** µg/m³ (mikrogram per kubikmeter)

**Typ:** S30 (PM Sensor)

**Användning:**
- Luftkvalitetsövervakning
- Hälsövervakning
- Miljöövervakning

### Gassensorer

#### Kolmonoxid (CO)

**Sensorväg:** `gassensor/co`

**Enhet:** ppm (parts per million)

**Typ:** GAS Sensor

**Användning:**
- Säkerhetsövervakning
- Miljöövervakning
- Gassäkerhet

#### Kvävedioxid (NO2)

**Sensorväg:** `gassensor/no2`

**Enhet:** ppb (parts per billion)

**Typ:** GAS Sensor

**Användning:**
- Luftkvalitetsövervakning
- Miljöövervakning
- Trafikövervakning

#### Ammoniak (NH3)

**Sensorväg:** `gassensor/nh3`

**Enhet:** ppm (parts per million)

**Typ:** GAS Sensor

**Användning:**
- Industriell övervakning
- Miljöövervakning
- Säkerhetsövervakning

**AQI-värden:**
- `gassensor/AQINO2` - NO2 AQI
- `gassensor/AQICO` - CO AQI

---

## Ljudsensorer

### Ljudnivå

**Sensorvägar:**
- `audsensor/sum` - Ljudnivå (dB)
- `audsensor/l` - Högförstärkande mikrofon (dB)
- `audsensor/r` - Lågförstärkande mikrofon (dB)

**Enhet:** dB (decibel)

**Typ:** AUD (Audio Sensor)

**Användning:**
- Ljudövervakning
- Komfortövervakning
- Säkerhetsövervakning

### Aggression-detektor

**Sensorväg:** `audsensor/rms0`

**Typ:** AUD (Audio Sensor)

**Användning:**
- Säkerhetsövervakning
- Mobbning-detektion
- Konflikt-detektion

### Skottlossning-detektor

**Sensorväg:** `audsensor/gs`

**Typ:** AUD (Audio Sensor)

**Användning:**
- Säkerhetsövervakning
- Nödsituationer
- Skolövervakning

### Nyckelordsdetektion

**Sensorvägar:**
- `audsensor/kw1` - Nyckelord 1
- `audsensor/kw2` - Nyckelord 2
- `audsensor/kw3` - Nyckelord 3
- `audsensor/kw4-8` - Ytterligare kanaler

**Tillgängliga nyckelordsfiler:**
- `help_emergency.kwd` - Engelska: "Help/Emergency"
- `help_nine_one_one.kwd` - "911"
- `help_triple_nine.kwd` - "999" (UK)
- `help_triple_zero.kwd` - "000" (Australien)
- `ES.Socorro_auxilio.kwd` - Spanska: "Hjälp"
- `FR.aidez_moi_au_secours.kwd` - Franska: "Hjälp mig"
- `IT.Aiuto_soccorso.kwd` - Italienska: "Hjälp"
- `PT.Ajuda_Emergencia.kwd` - Portugisiska: "Nöd"

**Användning:**
- Nödrop-detektion
- Säkerhetsövervakning
- Vårdövervakning

---

## Rörelsesensorer

### PIR-sensor

**Sensorväg:** `pir/max`

**Typ:** PIR (Passiv Infraröd)

**Användning:**
- Rörelsedetektering
- Säkerhetsövervakning
- Beläggningsanalys

### Accelerometer

**Sensorvägar:**
- `accsensor/x` - X-orientering (milli g)
- `accsensor/y` - Y-orientering (milli g)
- `accsensor/z` - Z-orientering (milli g)
- `accsensor/move` - Rörelse (mm/100)

**Typ:** ACC (Accelerometer)

**Format:**
```json
{
  "x": 35,      // Raw X-värde
  "y": -95,     // Raw Y-värde
  "z": 941,     // Raw Z-värde
  "ax": 35,     // Filtrerat X-värde
  "ay": -88,    // Filtrerat Y-värde
  "az": 951,    // Filtrerat Z-värde
  "mag": 12,    // Magnitud
  "move": 0     // Motion flag (0 eller 1)
}
```

**Användning:**
- Rörelsedetektering
- Tamper-detektering
- Vibration-analys
- Falldetektering

### Extern ingång

**Sensorväg:** `extin/inp`

**Användning:**
- Extern sensor-integration
- Trigger-input
- Custom integration

### BLE Beacon

**Sensorväg:** `blebcn/alert/status`

**Användning:**
- Panikknapp-status
- Närhetsdetektering
- Indoor positioning

---

## Hälsoindex

### Totalt Hälsoindex

**Sensorväg:** `HealthIndex/val`

**Enhet:** Index (0-5)

**Kategorier:**
- 0: Utmärkt
- 1: Mycket bra
- 2: Bra
- 3: Måttlig
- 4: Dålig
- 5: Mycket dålig

### Per-sensor Hälsoindex

**Sensorvägar:**
- `HealthIndex/co2/val` - CO2 hälsoindex
- `HealthIndex/hum/val` - Fuktighets hälsoindex
- `HealthIndex/pm1/val` - PM1 hälsoindex
- `HealthIndex/pm2p5/val` - PM2.5 hälsoindex
- `HealthIndex/pm10/val` - PM10 hälsoindex
- `HealthIndex/tvoc/val` - TVOC hälsoindex
- `HealthIndex/no2/val` - NO2 hälsoindex

**Användning:**
- Snabb översikt av IAQ
- Dashboard-visualisering
- Alarm-triggers

---

## Händelsetyper

Halo 3C har **26 förkonfigurerade händelsetyper** organiserade i grupper.

### Grupp 1: Vaping/Smoking

- **Vape** - E-cigarett/vape-detektion
- **THC** - THC/cannabis-detektion
- **Masking** - Maskeringsdetektion
- **Smoking** - Rökning-detektion

**Användning:**
- Skolövervakning
- Arbetsplatsövervakning
- Compliance

### Grupp 4: Säkerhet

- **Gunshot** - Skottlossning
- **Aggression** - Aggression (höga ljudnivåer)
- **Tamper** - Sabotage (rörelse/vibration)
- **Help** - Nödrop (nyckelord)
- **Motion** - Rörelse

**Användning:**
- Säkerhetsövervakning
- Skolövervakning
- Vårdövervakning

### Grupp 8: Luftkvalitet

- **Health_Index** - Övergripande hälsoindex
- **AQI** - Air Quality Index
- **TVOC** - Total VOC-nivå
- **CO2cal** - CO2-nivå
- **PM2.5** - Partiklar

**Användning:**
- IAQ-övervakning
- HVAC-integration
- Komfortövervakning

### Grupp 16: Miljövarningar

- **PM1**, **PM10** - Partikelnivåer
- **Humidity**, **Humidity_Low** - Fuktighet
- **Temp_C**, **Temp_C_Low** - Temperatur
- **NO2**, **CO**, **NH3** - Gasnivåer
- **Light** - Ljusnivå
- **Sound** - Ljudnivå

**Användning:**
- Miljöövervakning
- HVAC-integration
- Komfortövervakning

---

## Händelsekonfiguration

### Händelsestruktur

Varje händelse har följande konfiguration:

```json
{
  "id": "Vape",
  "enabled": true,
  "source": "pmsensor/raw/2",
  "threshold": 35,
  "operator": "gte",
  "hyst": 0,
  "pausem": 0,
  "relay1": 0,
  "relay2": 0,
  "ledclr": 65280,
  "ledpat": 0,
  "ledpri": 1,
  "sound": "",
  "emailset": true,
  "emailrst": false,
  "vmsset": true,
  "vmsrst": false,
  "cloud": true
}
```

### Parametrar

- **id**: Händelse-ID (unik identifierare)
- **enabled**: true/false (aktiverad/inaktiverad)
- **source**: Sensorväg (t.ex. "co2sensor/co2")
- **threshold**: Tröskelvärde
- **operator**: "gte" (>=), "lte" (<=), "eq" (==), etc.
- **hyst**: Hysteres för att undvika flapping
- **pausem**: Paus i minuter efter trigger
- **relay1**, **relay2**: Relay-åtgärd (0=ingen åtgärd, 1-n=åtgärd)
- **ledclr**: LED-färg (RGB hex)
- **ledpat**: LED-mönster-ID
- **ledpri**: LED-prioritet
- **sound**: Ljudfil att spela
- **emailset**, **emailrst**: E-postavisering vid set/reset
- **vmsset**, **vmsrst**: VMS-notifiering
- **cloud**: Skicka till moln

### Exempel: Konfigurera CO2-varning

```python
import requests
from requests.auth import HTTPBasicAuth

auth = HTTPBasicAuth("admin", "REDACTED_HALO_PASSWORD")
url = "http://REDACTED_HALO_IP/api/config"

# Hämta konfiguration
config = requests.get(url, auth=auth).json()

# Hitta CO2-händelse
for event in config['eventgen']['events']:
    if event['id'] == 'CO2cal':
        # Sätt tröskelvärde till 800 ppm
        event['threshold'] = 800
        # Aktivera e-postavisering
        event['emailset'] = True
        # Spela ljud
        event['sound'] = 'Emergency2C2N.wav'
        # Aktivera relay 1
        event['relay1'] = 1

# Uppdatera konfiguration
requests.post(url, auth=auth, json=config)
```

### Algoritmer

Halo använder avancerade algoritmer för detektion:

**DYNAMICVAPE:**
```
DYNAMICVAPE 20 600 200 600 300 4 300 0.7
```

**DYNAMICSMOKING:**
```
DYNAMICSMOKING 20 30 600 200 600 300 600 1.5 300 0.7 30 28
```

**DYNAMICMASK:**
```
DYNAMICMASK 20 600 4000 600 1500 20 60 60
```

Dessa analyserar sensorsignaler över tid för att upptäcka specifika mönster.

---

## Best Practices

1. **Använd hysteres** för att undvika flapping
2. **Sätt pausem** för att undvika spam
3. **Kombinera flera sensorer** med conditions
4. **Testa tröskelvärden** innan deployment
5. **Använd hälsoindex** för snabb översikt
6. **Konfigurera e-postaviseringar** för kritiska events
7. **Aktivera VMS-integration** för visuell verifiering

---

## Komplett Sensorlista

**Total: 43 sensorer**

### Miljö (5)
- Temperatur (°C, °F)
- Luftfuktighet (%)
- Lufttryck (hPa, inHg)
- Ljusnivå (Lux)

### Luftkvalitet (13)
- AQI
- CO2 (kalibrerat, ekvivalent)
- TVOC
- PM1, PM2.5, PM10
- NO2, CO, NH3
- AQI-värden för PM och gaser

### Ljud (11)
- Ljudnivå (sum, l, r)
- Aggression
- Skottlossning
- Nyckelord (8 kanaler)

### Rörelse (4)
- PIR
- Accelerometer (x, y, z, move)
- Extern ingång
- BLE Beacon

### Hälsoindex (8)
- Totalt hälsoindex
- Per-sensor hälsoindex (7 st)

### Övrigt (2)
- Systemstatus
- Metadata

---

**Se även:**
- [API_REFERENCE.md](API_REFERENCE.md) - API-referens för sensorer
- [QUICK_START.md](QUICK_START.md) - Snabbstart med sensorer
- [EXAMPLES.md](EXAMPLES.md) - Praktiska exempel

**Dokumentation skapad:** 2025-11-24

